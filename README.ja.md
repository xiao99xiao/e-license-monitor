# 日本の自動車教習所予約ヘルパー Chrome 拡張機能

[中文 (简体) 🇨🇳](README.md) | [English 🇺🇸](README.en.md) | [日本語 🇯🇵](README.ja.md)

e-license.jp ウェブサイトの自動車教習予約空き状況を監視し、自動通知を送信する Chrome 拡張機能です。

e-license.jp は、日本の複数の自動車教習所が生徒の教習予約に使用しているソリューションサイトです。

## 機能

- 🔍 **自動監視**: e-license.jp の教習予約空き状況を監視
- 📱 **即座の通知**: ntfy.sh を通じて通知を送信
- ⚙️ **設定可能なセレクター**: 監視要素とナビゲーションリンクをカスタマイズ
- 🔄 **自動更新**: 60 秒ごとにページデータを自動更新
- 📊 **デバッグログ**: 詳細な実行状況とエラー情報

## インストール

### 1. 拡張機能のダウンロード

```bash
git clone https://github.com/xiao99xiao/e-license-monitor.git
```

### 2. Chrome への読み込み

1. Chrome ブラウザを開く
2. `chrome://extensions/` にアクセス
3. 右上の「デベロッパーモード」を有効にする
4. 「パッケージ化されていない拡張機能を読み込む」をクリック
5. ダウンロードした `checker_chrome` フォルダを選択

### 3. 通知サービスの設定

1. [ntfy.sh アプリ](https://ntfy.sh/) をダウンロード
2. トピックを購読: `e-license-reserve-alert`
3. アプリがバックグラウンドで実行されていることを確認

**注意**: デフォルトの通知チャンネルは `e-license-reserve-alert` です。チャンネル名を変更するには、`content.js` の ntfy URL を修正してください：

```javascript
xhr.open("POST", "https://ntfy.sh/あなたのチャンネル名", true);
```

## 使用方法

### 詳細な手順

1. **自動車教習所予約システムへのアクセス**

   - ブラウザを開き、あなたの自動車教習所の e-license.jp ページにアクセス
   - 自動車教習所のアカウントにログイン
   - 教習予約ページ（第 1 段階、第 2 段階、検定予約）に移動

2. **監視の開始**

   - ブラウザのツールバーの拡張機能アイコン（E-License Monitor）をクリック
   - ポップアップで「Start Monitor」ボタンをクリック
   - ステータスが「Monitoring Active」と表示されたら監視が開始
   - 拡張機能が現在のページの予約空き状況の監視を開始

3. **監視の実行**

   - 拡張機能が 60 秒ごとに自動的に空き状況をチェック
   - 空きが見つかった場合、ntfy.sh を通じて通知を送信
   - ポップアップでデバッグログを確認して実行状況を把握

4. **監視の停止**
   - 拡張機能ポップアップで「Stop Monitor」ボタンをクリック
   - ステータスが「Monitoring Stopped」と表示されたら監視が停止

### 設定オプション

#### 空き要素セレクター

教習予約空き状況を監視する要素を指定（段階（第 1 段階、第 2 段階、検定）によって異なる値を設定する必要があります）：

- **デフォルト**: `a.simei`
- **その他の例**:
  - `.available-slots`
  - `[data-slot="available"]`
  - `div.slot-item a`

#### 予約リンクセレクター

教習予約ページへのナビゲーションリンクを指定（段階（第 1 段階、第 2 段階、検定）によって異なる値を設定する必要があります）：

- **デフォルト**: `a[data-kamoku="0"]`
- **その他の例**:
  - `.dropdown-menu.show a:nth-child(3)`
  - `a[data-action="/el32/pc/reserv/p06/p06a/nav"]`

#### 設定手順

1. 拡張機能ポップアップでセレクター値を変更
2. 「Save Configuration」をクリックして保存
3. 新しい設定を適用するために監視を再開

## 通知形式

教習予約空きが見つかった場合、以下の形式で通知が送信されます：

```
🎉 SLOTS AVAILABLE! 2024-01-15 10:00, 2024-01-15 14:00 😄
```

## トラブルシューティング

### よくある問題

**Q: 監視で教習空きが見つからない**

- セレクター設定が正しいか確認
- デバッグログのエラー情報を確認
- ウェブページの要素構造が変更されていないか確認

**Q: 通知が届かない**

- ntfy.sh アプリが実行中か確認
- 正しいチャンネルを購読しているか確認: `e-license-reserve-alert`
- ネットワーク接続を確認
- デバッグログの送信状況を確認
- カスタムチャンネルを使用する場合、`content.js` の ntfy URL を修正

**Q: 設定が保存されない**

- 入力セレクターが空でないか確認
- ブラウザコンソールでエラーを確認
- 拡張機能を再読み込み

### デバッグ情報

拡張機能は詳細なデバッグ情報を提供します：

- 監視ステータスの変更
- 要素チェックの結果
- 通知送信状況
- エラーと警告メッセージ

## 技術仕様

- **Chrome 拡張機能バージョン**: Manifest V3
- **権限**: `activeTab`, `storage`, `scripting`
- **対応ウェブサイト**: `*.e-license.jp/*`
- **通知サービス**: ntfy.sh
- **デフォルト通知チャンネル**: `e-license-reserve-alert`
- **監視間隔**: 60 秒

### カスタム通知チャンネル

カスタム ntfy チャンネルを使用する場合：

1. ntfy.sh アプリでカスタムチャンネルを購読
2. `content.js` ファイルの 2 箇所で ntfy URL を修正:

   ```javascript
   // sendAlert 関数内（215行目付近）
   xhr.open("POST", "https://ntfy.sh/あなたのチャンネル名", true);

   // sendUrgentAlert 関数内（275行目付近）
   xhr.open("POST", "https://ntfy.sh/あなたのチャンネル名", true);
   ```

3. 拡張機能を再読み込み

## 開発情報

### ファイル構造

```
/
├── manifest.json          # 拡張機能マニフェスト
├── background.js           # バックグラウンドスクリプト
├── content.js             # コンテンツスクリプト
├── popup.html             # ポップアップインターフェース
├── popup.js               # ポップアップロジック
└── images/                # 拡張機能アイコン
```

### 主要機能

- **監視フロー**: ページ要素のチェック → 通知送信 → 自動更新
- **状態管理**: Chrome ストレージ API を使用した永続的な設定
- **メッセージ通信**: ポップアップ ↔ バックグラウンドスクリプト ↔ コンテンツスクリプト

## ライセンス

このプロジェクトは Creative Commons Attribution-NonCommercial 4.0 International License の下でライセンスされています。詳細は [LICENSE](LICENSE) を参照してください。

## 貢献

プルリクエストと貢献を歓迎します！貢献が CC BY-NC ライセンス条項に準拠していることを確認してください。

---

**注意**: この拡張機能は e-license.jp ウェブサイトでのみ動作します。自動車教習所のアカウントを持ち、ウェブサイトにアクセスできることを確認してください。
